/*
BeautifyJson v0.2

Copyright 2013, Tomas Thelander
Licensed under the GNU General Public License

http://dev.tthe.se/bjson

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
(function($){$.fn.BeautifyJson=function(input){if(this.length==0)return;if(typeof input=='object'||input==null){var options=$.extend({'indent':30,'hover':false,'links':true,'pre':false,'wrapper':'%bjson%','placeholder':'%bjson%'},input);var level=0;var print=function(obj,comma){if(Object.prototype.toString.call(obj)==='[object Array]'){var string='<div class="bjson-inline">[</div>'+"\n";level++;for(i=0;i<obj.length;i++){if(i==obj.length-1)appendComma=false;else appendComma=true;string+=Array(level+1).join("\t")+'<div class="bjson-indent" style="margin-left:'+options.indent+'px;"><span class="bjson-bg">'+print(obj[i],appendComma)+'</span></div>'}level--;string+=Array(level+1).join("\t")+'<div style="margin-left: 0px;" class="bjson-inline">]</div>';if(comma){string+=','}return string+"\n"}else if(typeof obj=='object'&&obj!=null){var string='<div class="bjson-inline">{</div>'+"\n";var count=0;for(var name in obj){if(obj.hasOwnProperty(name)){count++}}var i=1;level++;for(var name in obj){if(obj.hasOwnProperty(name)){if(count==i)appendComma=false;else appendComma=true;string+=Array(level+1).join("\t")+'<div class="bjson-indent" style="margin-left:'+options.indent+'px;"><span class="bjson-bg"><span class="bjson-property">"'+name+'"</span> : '+print(obj[name],appendComma)+'</span></div>'}i++}level--;string+=Array(level+1).join("\t")+'<div style="margin-left:0px;" class="bjson-inline">}</div>';if(comma)string+=',';return string+"\n"}else if(typeof obj=='string'){var patternFirst=new RegExp('^https?:\\/\\/');var patternFull=new RegExp('^(https?:\\/\\/)?'+'((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+'((\\d{1,3}\\.){3}\\d{1,3}))'+'(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+'(\\?[;&a-z\\d%_.~+=-]*)?'+'(\\#[-a-z\\d_]*)?$','i');if(!options.links){return'<span class="bjson-string">"'+obj+'"</span>'+(comma?',':'')+"\n"}else{if(obj.match(patternFirst)){if(obj.match(patternFull)){return'<span class="bjson-string">"<a href="'+obj+'">'+obj+'</a>"</span>'+(comma?',':'')+"\n"}}return'<span class="bjson-string">"'+obj+'"</span>'+(comma?',':'')+"\n"}}else if(typeof obj=='number'){return'<span class="bjson-number">'+obj.toString()+'</span>'+(comma?',':'')+"\n"}else if(typeof obj=='boolean'){return'<span class="bjson-boolean">'+obj.toString()+'</span>'+(comma?',':'')+"\n"}else if(typeof obj=='object'&&obj==null){return'<span class="bjson-null">null</span>'+(comma?',':'')+"\n"}else{return'undefined'+(comma?',':'')+"\n"}};this.each(function(i,e){var plaintext=$(e).text();if($(e).data().pre){$(e).css('white-space','normal');$(e).data('pre',false)}try{var json=JSON.parse(plaintext)}catch(err){$(e).html('Error parsing JSON.').addClass('bjson-container').css('color','red');return}$(e).html('<span class="bjson-bg"></span>').addClass('bjson-container');var firstwrapper=options.wrapper.substr(0,options.wrapper.indexOf(options.placeholder));var lastwrapper=options.wrapper.substr(options.wrapper.indexOf(options.placeholder)+options.placeholder.length);var styledJson=print(json);$(e).find('.bjson-bg').append('<span class="bjson-wrapper">'+firstwrapper+'</span>'+styledJson+'<span class="bjson-wrapper">'+lastwrapper+'</span>');$(e).data('bjson-pre',styledJson.replace(/(<([^>]+)>)/ig,""));if(options.hover){$(e).find('.bjson-bg').mouseover(function(ev){ev.stopPropagation();$(e).find('.bjson-bg').removeClass('bjson-indenthover');$(this).addClass('bjson-indenthover')}).mouseleave(function(ev){ev.stopPropagation();$(this).removeClass('bjson-indenthover')})}if(options.pre){$(e).BeautifyJson('pre')}})}else if(input=='pre'){this.each(function(i,e){$(e).html($(e).data('bjson-pre')).css('white-space','pre');$(e).data('pre',true)})}return this}})(jQuery);