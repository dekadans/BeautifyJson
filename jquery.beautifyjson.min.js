/*
BeautifyJson v0.1

Copyright 2013, Tomas Thelander
Licensed under the GNU General Public License

http://dev.tthe.se/bjson

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
(function(e){e.fn.BeautifyJson=function(t){if(this.length==0)return;var n=e.extend({indent:30,hover:false,links:true,wrapper:"%bjson%",placeholder:"%bjson%"},t);var r=function(e,t){if(Object.prototype.toString.call(e)==="[object Array]"){var i='<div class="bjson-inline">[</div>';for(u=0;u<e.length;u++){if(u==e.length-1)appendComma=false;else appendComma=true;i+='<div class="bjson-indent" style="margin-left:'+n.indent+'px;"><span class="bjson-bg">'+r(e[u],appendComma)+"</span></div>"}i+='<div style="margin-left: 0px;" class="bjson-inline">]</div>';if(t){i+=","}return i}else if(typeof e=="object"&&e!=null){var i='<div class="bjson-inline">{</div>';var s=0;for(var o in e){if(e.hasOwnProperty(o)){s++}}var u=1;for(var o in e){if(e.hasOwnProperty(o)){if(s==u)appendComma=false;else appendComma=true;i+='<div class="bjson-indent" style="margin-left:'+n.indent+'px;"><span class="bjson-bg"><span class="bjson-property">'+o+"</span> : "+r(e[o],appendComma)+"</span></div>"}u++}i+='<div style="margin-left:0px;" class="bjson-inline">}</div>';if(t)i+=",";return i}else if(typeof e=="string"){var a=new RegExp("^https?:\\/\\/");var f=new RegExp("^(https?:\\/\\/)?"+"((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|"+"((\\d{1,3}\\.){3}\\d{1,3}))"+"(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*"+"(\\?[;&a-z\\d%_.~+=-]*)?"+"(\\#[-a-z\\d_]*)?$","i");if(!n.links){return'<span class="bjson-string">"'+e+'"</span>'+(t?",":"")}else{if(e.match(a)){if(e.match(f)){return'<span class="bjson-string">"<a href="'+e+'">'+e+'</a>"</span>'+(t?",":"")}}return'<span class="bjson-string">"'+e+'"</span>'+(t?",":"")}}else if(typeof e=="number"){return'<span class="bjson-number">'+e.toString()+"</span>"+(t?",":"")}else if(typeof e=="boolean"){return'<span class="bjson-boolean">'+e.toString()+"</span>"+(t?",":"")}else if(typeof e=="object"&&e==null){return'<span class="bjson-null">null</span>'+(t?",":"")}else{return"undefined"+(t?",":"")}};this.each(function(t,i){var s=e(i).text();try{var o=JSON.parse(s)}catch(u){e(i).html("Error parsing JSON.").addClass("bjson-container").css("color","red");return}e(i).html('<span class="bjson-bg"></span>').addClass("bjson-container");e(i).data("bjson-plain",s);var a=n.wrapper.substr(0,n.wrapper.indexOf(n.placeholder));var f=n.wrapper.substr(n.wrapper.indexOf(n.placeholder)+n.placeholder.length);e(i).find(".bjson-bg").append('<span class="bjson-wrapper">'+a+"</span>"+r(o)+'<span class="bjson-wrapper">'+f+"</span>");if(n.hover){e(i).find(".bjson-bg").mouseover(function(t){t.stopPropagation();e(i).find(".bjson-bg").removeClass("bjson-indenthover");e(this).addClass("bjson-indenthover")}).mouseleave(function(t){t.stopPropagation();e(this).removeClass("bjson-indenthover")})}})}})(jQuery)